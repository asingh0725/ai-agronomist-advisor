<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crop Copilot Email Automation System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f5f5f5;
            color: #333;
        }

        header {
            background: linear-gradient(135deg, #2E7D32 0%, #1B5E20 100%);
            color: white;
            padding: 40px 20px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        header h1 {
            font-size: 32px;
            margin-bottom: 8px;
        }

        header p {
            font-size: 16px;
            opacity: 0.9;
        }

        .container {
            max-width: 1400px;
            margin: 40px auto;
            padding: 0 20px;
        }

        .flow-diagram {
            background: white;
            border-radius: 8px;
            padding: 30px;
            margin-bottom: 40px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .flow-diagram h2 {
            color: #2E7D32;
            margin-bottom: 20px;
            font-size: 20px;
        }

        .flow-diagram-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .flow-item {
            padding: 15px;
            background: #f9f9f9;
            border-left: 4px solid #2E7D32;
            border-radius: 4px;
        }

        .flow-item h3 {
            color: #2E7D32;
            font-size: 14px;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .flow-item p {
            font-size: 13px;
            line-height: 1.6;
            color: #666;
        }

        .tabs {
            display: flex;
            gap: 0;
            border-bottom: 2px solid #ddd;
            margin-bottom: 30px;
            background: white;
            border-radius: 8px 8px 0 0;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .tab-button {
            flex: 1;
            padding: 16px 20px;
            background: #f5f5f5;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: #666;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .tab-button:hover {
            background: #efefef;
        }

        .tab-button.active {
            background: white;
            color: #2E7D32;
            border-bottom-color: #2E7D32;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .email-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .email-card {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 1px 4px rgba(0,0,0,0.1);
            transition: box-shadow 0.3s;
        }

        .email-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .email-header {
            background: #2E7D32;
            color: white;
            padding: 20px;
            border-bottom: 4px solid #1B5E20;
        }

        .email-header h3 {
            font-size: 18px;
            margin-bottom: 8px;
        }

        .email-meta {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            font-size: 13px;
            line-height: 1.6;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid rgba(255,255,255,0.2);
        }

        .email-meta-item {
            display: flex;
            flex-direction: column;
        }

        .email-meta-label {
            font-weight: 600;
            opacity: 0.8;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .email-meta-value {
            opacity: 0.95;
        }

        .email-specs {
            padding: 20px;
            border-bottom: 1px solid #eee;
        }

        .spec-row {
            margin-bottom: 15px;
            font-size: 13px;
        }

        .spec-row:last-child {
            margin-bottom: 0;
        }

        .spec-label {
            font-weight: 600;
            color: #2E7D32;
            display: block;
            margin-bottom: 6px;
            text-transform: uppercase;
            font-size: 11px;
            letter-spacing: 0.5px;
        }

        .spec-value {
            color: #666;
            padding: 8px 12px;
            background: #f9f9f9;
            border-radius: 4px;
            border-left: 3px solid #2E7D32;
            word-break: break-word;
        }

        .email-preview {
            padding: 20px;
            background: #fafafa;
            border-top: 1px solid #eee;
        }

        .email-preview-label {
            font-weight: 600;
            color: #2E7D32;
            display: block;
            margin-bottom: 12px;
            text-transform: uppercase;
            font-size: 11px;
            letter-spacing: 0.5px;
        }

        .email-body {
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 20px;
            font-family: Georgia, serif;
            line-height: 1.6;
            color: #333;
            margin-bottom: 15px;
        }

        .email-body-header {
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #2E7D32;
            padding-bottom: 15px;
        }

        .email-logo {
            font-weight: 700;
            font-size: 24px;
            color: #2E7D32;
            margin-bottom: 5px;
        }

        .email-preheader {
            color: #999;
            font-size: 13px;
            font-style: italic;
        }

        .email-body h2 {
            color: #2E7D32;
            font-size: 20px;
            margin: 20px 0 15px 0;
            font-family: inherit;
        }

        .email-body h3 {
            color: #1B5E20;
            font-size: 16px;
            margin: 15px 0 10px 0;
            font-family: inherit;
        }

        .email-body p {
            margin-bottom: 15px;
        }

        .email-body ul, .email-body ol {
            margin-left: 20px;
            margin-bottom: 15px;
        }

        .email-body li {
            margin-bottom: 8px;
        }

        .email-cta {
            background: #2E7D32;
            color: white;
            padding: 12px 24px;
            border-radius: 4px;
            text-decoration: none;
            display: inline-block;
            margin: 15px 0;
            font-weight: 600;
            text-align: center;
        }

        .email-cta-secondary {
            background: #f0f0f0;
            color: #2E7D32;
            padding: 12px 24px;
            border-radius: 4px;
            text-decoration: none;
            display: inline-block;
            margin: 10px 5px 10px 0;
            font-weight: 500;
            border: 1px solid #ddd;
        }

        .email-footer {
            font-size: 12px;
            color: #999;
            border-top: 1px solid #eee;
            margin-top: 20px;
            padding-top: 15px;
            text-align: center;
        }

        .email-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }

        .email-table th, .email-table td {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: left;
        }

        .email-table th {
            background: #f5f5f5;
            color: #2E7D32;
            font-weight: 600;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .btn-copy {
            background: #2E7D32;
            color: white;
            flex: 1;
            min-width: 120px;
        }

        .btn-copy:hover {
            background: #1B5E20;
        }

        .btn-copy.copied {
            background: #4CAF50;
        }

        .btn-preview {
            background: #f5f5f5;
            color: #333;
            border: 1px solid #ddd;
            flex: 1;
            min-width: 120px;
        }

        .btn-preview:hover {
            background: #efefef;
        }

        .export-section {
            background: white;
            border-radius: 8px;
            padding: 30px;
            margin-bottom: 40px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .export-section h2 {
            color: #2E7D32;
            margin-bottom: 20px;
            font-size: 20px;
        }

        .export-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .export-option {
            padding: 15px;
            border: 2px solid #2E7D32;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .export-option:hover {
            background: #f0f8f0;
        }

        .export-option h3 {
            color: #2E7D32;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .export-option p {
            font-size: 12px;
            color: #666;
        }

        .export-preview {
            background: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 15px;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 11px;
            max-height: 400px;
            overflow-y: auto;
            color: #333;
            line-height: 1.4;
        }

        .export-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn-export {
            padding: 10px 20px;
            background: #2E7D32;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .btn-export:hover {
            background: #1B5E20;
        }

        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #4CAF50;
            color: white;
            padding: 16px 24px;
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .footer {
            background: #f5f5f5;
            padding: 40px 20px;
            text-align: center;
            color: #666;
            font-size: 13px;
            margin-top: 60px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 32px;
            font-weight: 700;
            color: #2E7D32;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 13px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        @media (max-width: 768px) {
            .email-cards {
                grid-template-columns: 1fr;
            }

            .tabs {
                flex-direction: column;
            }

            .email-meta {
                grid-template-columns: 1fr;
            }

            .tab-button {
                text-align: left;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>Crop Copilot Email Automation System</h1>
        <p>Complete email marketing automation flows for agriculture SaaS</p>
    </header>

    <div class="container">
        <div class="stats">
            <div class="stat">
                <div class="stat-number">4</div>
                <div class="stat-label">Automation Flows</div>
            </div>
            <div class="stat">
                <div class="stat-number">12</div>
                <div class="stat-label">Email Templates</div>
            </div>
            <div class="stat">
                <div class="stat-number">100%</div>
                <div class="stat-label">Personalization</div>
            </div>
            <div class="stat">
                <div class="stat-number">24-360</div>
                <div class="stat-label">Days Span</div>
            </div>
        </div>

        <div class="flow-diagram">
            <h2>Automation Flows Overview</h2>
            <div class="flow-diagram-content">
                <div class="flow-item">
                    <h3>Flow 1: Free User Onboarding</h3>
                    <p><strong>Duration:</strong> 30 days<br><strong>Emails:</strong> 4<br><strong>Triggers:</strong> Signup, time-based delays, monthly reset<br><strong>Goal:</strong> Activate and feature discovery</p>
                </div>
                <div class="flow-item">
                    <h3>Flow 2: Conversion Upgrade</h3>
                    <p><strong>Duration:</strong> 10 days<br><strong>Emails:</strong> 3<br><strong>Triggers:</strong> Usage limit hit, case studies, discount offers<br><strong>Goal:</strong> Convert free to paid</p>
                </div>
                <div class="flow-item">
                    <h3>Flow 3: Seasonal Alerts</h3>
                    <p><strong>Duration:</strong> Triggered<br><strong>Emails:</strong> 2 templates<br><strong>Triggers:</strong> Disease risk, seasonal prep<br><strong>Goal:</strong> Drive engagement & retention</p>
                </div>
                <div class="flow-item">
                    <h3>Flow 4: Churn Prevention</h3>
                    <p><strong>Duration:</strong> 90 days<br><strong>Emails:</strong> 3<br><strong>Triggers:</strong> Inactivity, off-season, renewal<br><strong>Goal:</strong> Prevent cancellation & retention</p>
                </div>
            </div>
        </div>

        <div class="tabs" id="flowTabs">
            <button class="tab-button active" data-tab="flow1">Flow 1: Onboarding</button>
            <button class="tab-button" data-tab="flow2">Flow 2: Conversion</button>
            <button class="tab-button" data-tab="flow3">Flow 3: Seasonal</button>
            <button class="tab-button" data-tab="flow4">Flow 4: Churn Prevention</button>
        </div>

        <!-- FLOW 1: Free User Onboarding -->
        <div id="flow1" class="tab-content active">
            <div class="email-cards" id="flow1-emails"></div>
        </div>

        <!-- FLOW 2: Conversion Upgrade Sequence -->
        <div id="flow2" class="tab-content">
            <div class="email-cards" id="flow2-emails"></div>
        </div>

        <!-- FLOW 3: Seasonal Alert System -->
        <div id="flow3" class="tab-content">
            <div class="email-cards" id="flow3-emails"></div>
        </div>

        <!-- FLOW 4: Churn Prevention -->
        <div id="flow4" class="tab-content">
            <div class="email-cards" id="flow4-emails"></div>
        </div>

        <!-- Export Section -->
        <div class="export-section">
            <h2>Export Email Specs</h2>
            <p style="margin-bottom: 20px; color: #666;">Export all email automation specs in formats compatible with Customer.io, Mailchimp, and other email platforms.</p>
            
            <div class="export-options">
                <div class="export-option" onclick="app.toggleExportFormat('json')">
                    <h3>JSON</h3>
                    <p>For Customer.io integration</p>
                </div>
                <div class="export-option" onclick="app.toggleExportFormat('csv')">
                    <h3>CSV</h3>
                    <p>For Mailchimp import</p>
                </div>
                <div class="export-option" onclick="app.toggleExportFormat('markdown')">
                    <h3>Markdown</h3>
                    <p>For documentation</p>
                </div>
            </div>

            <div id="exportPreviewContainer" style="display: none;">
                <div class="export-preview" id="exportPreview"></div>
                <div class="export-buttons">
                    <button class="btn-export" onclick="app.downloadExport()">Download</button>
                    <button class="btn-export" onclick="app.copyExport()" style="background: #666;">Copy to Clipboard</button>
                </div>
            </div>
        </div>
    </div>

    <div class="footer">
        <p>Crop Copilot Email Automation System | Production-Ready Email Marketing Flows | v1.0</p>
    </div>

    <script>
        // ============================================
        // EMAIL AUTOMATION DATA
        // ============================================

        const emailFlows = {
            flow1: {
                title: "Free User Onboarding",
                description: "4-email sequence for free tier users",
                emails: [
                    {
                        id: "welcome",
                        number: 1,
                        title: "Welcome Email",
                        subject: "Your first diagnosis is waiting",
                        previewText: "Upload a photo or paste lab data to get started",
                        trigger: "Signup",
                        delay: "Immediate",
                        variables: [],
                        htmlBody: `
<div style="background: white; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; max-width: 600px; margin: 0 auto;">
    <table width="100%" cellpadding="0" cellspacing="0" style="background: #2E7D32;">
        <tr>
            <td style="padding: 30px 20px; text-align: center;">
                <h1 style="color: white; margin: 0; font-size: 28px; font-weight: 700;">Crop Copilot</h1>
                <p style="color: rgba(255,255,255,0.8); margin: 5px 0 0 0; font-size: 14px;">AI Crop Diagnosis</p>
            </td>
        </tr>
    </table>

    <table width="100%" cellpadding="0" cellspacing="0" style="background: white;">
        <tr>
            <td style="padding: 40px 30px;">
                <p style="color: #333; font-size: 16px; line-height: 1.6; margin: 0 0 20px 0;">Hi there,</p>

                <p style="color: #333; font-size: 16px; line-height: 1.6; margin: 0 0 20px 0;">Welcome to Crop Copilot! We're excited to help you diagnose crop diseases in seconds and make data-driven decisions for your farm.</p>

                <p style="color: #333; font-size: 16px; line-height: 1.6; margin: 0 0 30px 0;">You've got <strong>3 free diagnoses</strong> this month to test drive our platform. Here's how to get started:</p>

                <div style="background: #f9f9f9; border-left: 4px solid #2E7D32; padding: 20px; margin: 0 0 30px 0;">
                    <h3 style="color: #2E7D32; margin: 0 0 15px 0; font-size: 16px;">Quick Start Guide</h3>
                    <ol style="color: #333; font-size: 14px; line-height: 1.8; margin: 0; padding-left: 20px;">
                        <li><strong>Upload a photo</strong> - Take a photo of the affected leaf or plant area</li>
                        <li><strong>Provide location</strong> - Select your crop and region for better accuracy</li>
                        <li><strong>Get diagnosis</strong> - AI analysis in under 30 seconds with treatment options</li>
                    </ol>
                </div>

                <p style="color: #333; font-size: 16px; line-height: 1.6; margin: 0 0 20px 0;"><strong>Pro tip:</strong> You can also paste lab data for even more precise recommendations. No photo needed!</p>

                <table width="100%" cellpadding="0" cellspacing="0">
                    <tr>
                        <td align="center" style="padding: 20px 0;">
                            <a href="#" style="background: #2E7D32; color: white; padding: 14px 32px; text-decoration: none; border-radius: 4px; font-weight: 600; display: inline-block; font-size: 15px;">Start Your First Diagnosis</a>
                        </td>
                    </tr>
                </table>

                <p style="color: #666; font-size: 14px; line-height: 1.6; margin: 30px 0 0 0; text-align: center;">Questions? Our support team is here to help.</p>

                <div style="background: #f5f5f5; padding: 20px; margin: 20px 0 0 0; border-radius: 4px; text-align: center;">
                    <p style="color: #666; font-size: 13px; margin: 0;">¬© 2024 Crop Copilot. All rights reserved. <br>Made for farmers, by farmers who understand agriculture.</p>
                </div>
            </td>
        </tr>
    </table>
</div>
                        `
                    },
                    {
                        id: "feature_discovery",
                        number: 2,
                        title: "Feature Discovery",
                        subject: "Did you know you can upload lab data?",
                        previewText: "Get even more precise recommendations",
                        trigger: "24hr after signup",
                        delay: "24 hours",
                        variables: [],
                        htmlBody: `
<div style="background: white; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; max-width: 600px; margin: 0 auto;">
    <table width="100%" cellpadding="0" cellspacing="0" style="background: #2E7D32;">
        <tr>
            <td style="padding: 30px 20px; text-align: center;">
                <h1 style="color: white; margin: 0; font-size: 28px; font-weight: 700;">Crop Copilot</h1>
            </td>
        </tr>
    </table>

    <table width="100%" cellpadding="0" cellspacing="0" style="background: white;">
        <tr>
            <td style="padding: 40px 30px;">
                <p style="color: #333; font-size: 16px; line-height: 1.6; margin: 0 0 20px 0;">Hi,</p>

                <p style="color: #333; font-size: 16px; line-height: 1.6; margin: 0 0 20px 0;">We noticed you haven't started a diagnosis yet. Before you do, we want to show you a feature that many farmers find incredibly valuable: <strong>Lab Data Input</strong>.</p>

                <h3 style="color: #2E7D32; font-size: 18px; margin: 30px 0 15px 0;">Photo Analysis vs. Lab Data Analysis</h3>

                <table width="100%" cellpadding="12" cellspacing="0" style="border-collapse: collapse; margin: 0 0 30px 0;">
                    <tr style="background: #f5f5f5;">
                        <th style="border: 1px solid #ddd; text-align: left; color: #2E7D32; font-weight: 600; padding: 12px;">Photo Upload</th>
                        <th style="border: 1px solid #ddd; text-align: left; color: #2E7D32; font-weight: 600; padding: 12px;">Lab Data</th>
                    </tr>
                    <tr>
                        <td style="border: 1px solid #ddd; padding: 12px; color: #333;">Visual disease detection</td>
                        <td style="border: 1px solid #ddd; padding: 12px; color: #333;"><strong>Nutrient deficiencies</strong></td>
                    </tr>
                    <tr style="background: #fafafa;">
                        <td style="border: 1px solid #ddd; padding: 12px; color: #333;">Instant results</td>
                        <td style="border: 1px solid #ddd; padding: 12px; color: #333;"><strong>Soil health data</strong></td>
                    </tr>
                    <tr>
                        <td style="border: 1px solid #ddd; padding: 12px; color: #333;">Field scouting</td>
                        <td style="border: 1px solid #ddd; padding: 12px; color: #333;"><strong>Precision recommendations</strong></td>
                    </tr>
                </table>

                <p style="color: #333; font-size: 16px; line-height: 1.6; margin: 0 0 20px 0;">Many growers use both methods for complete crop health insights. Lab data eliminates guesswork and helps you:</p>

                <ul style="color: #333; font-size: 14px; line-height: 1.8; margin: 0 0 30px 0; padding-left: 20px;">
                    <li>Identify nutrient deficiencies before they affect yield</li>
                    <li>Plan precise fertility programs</li>
                    <li>Avoid costly over-application</li>
                    <li>Increase ROI by 15-25% on fertilizer</li>
                </ul>

                <table width="100%" cellpadding="0" cellspacing="0">
                    <tr>
                        <td align="center" style="padding: 20px 0;">
                            <a href="#" style="background: #2E7D32; color: white; padding: 14px 32px; text-decoration: none; border-radius: 4px; font-weight: 600; display: inline-block; font-size: 15px;">Upload Lab Data</a>
                        </td>
                    </tr>
                </table>

                <p style="color: #666; font-size: 14px; line-height: 1.6; margin: 30px 0 0 0;">You still have 3 free diagnoses available. Try lab data input on your next one!</p>

                <div style="background: #f5f5f5; padding: 20px; margin: 20px 0 0 0; border-radius: 4px;">
                    <p style="color: #666; font-size: 13px; margin: 0;">¬© 2024 Crop Copilot</p>
                </div>
            </td>
        </tr>
    </table>
</div>
                        `
                    },
                    {
                        id: "regional_insight",
                        number: 3,
                        title: "Regional Insight",
                        subject: "Here's what {{crop}} growers in {{state}} are diagnosing",
                        previewText: "Regional insights from your area",
                        trigger: "72hr after signup",
                        delay: "72 hours",
                        variables: ["{{crop}}", "{{state}}"],
                        htmlBody: `
<div style="background: white; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; max-width: 600px; margin: 0 auto;">
    <table width="100%" cellpadding="0" cellspacing="0" style="background: #2E7D32;">
        <tr>
            <td style="padding: 30px 20px; text-align: center;">
                <h1 style="color: white; margin: 0; font-size: 28px; font-weight: 700;">Crop Copilot</h1>
                <p style="color: rgba(255,255,255,0.8); margin: 5px 0 0 0; font-size: 14px;">Regional Insights</p>
            </td>
        </tr>
    </table>

    <table width="100%" cellpadding="0" cellspacing="0" style="background: white;">
        <tr>
            <td style="padding: 40px 30px;">
                <p style="color: #333; font-size: 16px; line-height: 1.6; margin: 0 0 20px 0;">Hi,</p>

                <p style="color: #333; font-size: 16px; line-height: 1.6; margin: 0 0 20px 0;">We've analyzed diagnoses from {{crop}} growers across {{state}} this week, and we're seeing some important trends you should know about:</p>

                <div style="background: #f9f9f9; border-left: 4px solid #2E7D32; padding: 20px; margin: 0 0 20px 0;">
                    <h3 style="color: #2E7D32; margin: 0 0 15px 0; font-size: 16px;">üìä This Week's Top Issues in {{state}}</h3>
                    <ol style="color: #333; font-size: 14px; line-height: 1.8; margin: 0; padding-left: 20px;">
                        <li><strong>Powdery Mildew</strong> - 34% increase in detections (warming temps)</li>
                        <li><strong>Nitrogen Deficiency</strong> - Trending in northern counties post-rain</li>
                        <li><strong>Root Rot Risk</strong> - Elevated due to recent moisture</li>
                    </ol>
                </div>

                <h3 style="color: #2E7D32; font-size: 16px; margin: 20px 0 15px 0;">Why This Matters for You</h3>
                <p style="color: #333; font-size: 14px; line-height: 1.6; margin: 0 0 15px 0;">If you're seeing similar symptoms on your {{crop}}, you're not alone. Early scouting and diagnosis could save significant yield losses. Many farmers in your region are already taking preventive action.</p>

                <p style="color: #333; font-size: 14px; line-height: 1.6; margin: 0 0 25px 0;"><strong>Recommended action:</strong> Scout your fields today and use Crop Copilot to identify any issues early. You have 3 free diagnoses to use this month.</p>

                <table width="100%" cellpadding="0" cellspacing="0">
                    <tr>
                        <td align="center" style="padding: 20px 0;">
                            <a href="#" style="background: #2E7D32; color: white; padding: 14px 32px; text-decoration: none; border-radius: 4px; font-weight: 600; display: inline-block; font-size: 15px;">Start a Diagnosis</a>
                        </td>
                    </tr>
                </table>

                <div style="background: #fef3cd; border-left: 4px solid #ffc107; padding: 15px; margin: 25px 0 0 0; border-radius: 4px;">
                    <p style="color: #856404; font-size: 13px; margin: 0;"><strong>Pro tip:</strong> Set scouting reminders every 5-7 days during peak season. Early detection = better outcomes.</p>
                </div>

                <div style="background: #f5f5f5; padding: 20px; margin: 20px 0 0 0; border-radius: 4px;">
                    <p style="color: #666; font-size: 13px; margin: 0;">¬© 2024 Crop Copilot | Data from {{state}} agricultural network</p>
                </div>
            </td>
        </tr>
    </table>
</div>
                        `
                    },
                    {
                        id: "reset_reminder",
                        number: 4,
                        title: "Reset Reminder",
                        subject: "Your free diagnoses reset tomorrow",
                        previewText: "3 new diagnoses available on the 1st",
                        trigger: "Day before monthly reset",
                        delay: "~30 days",
                        variables: [],
                        htmlBody: `
<div style="background: white; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; max-width: 600px; margin: 0 auto;">
    <table width="100%" cellpadding="0" cellspacing="0" style="background: #2E7D32;">
        <tr>
            <td style="padding: 30px 20px; text-align: center;">
                <h1 style="color: white; margin: 0; font-size: 28px; font-weight: 700;">Crop Copilot</h1>
            </td>
        </tr>
    </table>

    <table width="100%" cellpadding="0" cellspacing="0" style="background: white;">
        <tr>
            <td style="padding: 40px 30px;">
                <p style="color: #333; font-size: 16px; line-height: 1.6; margin: 0 0 20px 0;">Hi,</p>

                <p style="color: #333; font-size: 16px; line-height: 1.6; margin: 0 0 20px 0;">Good news! Your free diagnosis allowance resets <strong>tomorrow</strong>. You'll have 3 fresh diagnoses to use throughout the month.</p>

                <div style="background: #f0f8f0; border: 2px solid #2E7D32; padding: 20px; margin: 0 0 30px 0; border-radius: 4px; text-align: center;">
                    <p style="color: #2E7D32; font-size: 18px; font-weight: 600; margin: 0;">3 Diagnoses Ready Tomorrow</p>
                    <p style="color: #666; font-size: 14px; margin: 5px 0 0 0;">Resetting at midnight (your local time)</p>
                </div>

                <h3 style="color: #2E7D32; font-size: 16px; margin: 20px 0 15px 0;">Your Usage This Month</h3>

                <table width="100%" cellpadding="12" cellspacing="0" style="border-collapse: collapse; margin: 0 0 30px 0;">
                    <tr style="background: #f5f5f5;">
                        <th style="border: 1px solid #ddd; text-align: left; color: #333; font-weight: 600; padding: 12px;">Metric</th>
                        <th style="border: 1px solid #ddd; text-align: right; color: #333; font-weight: 600; padding: 12px;">Count</th>
                    </tr>
                    <tr>
                        <td style="border: 1px solid #ddd; padding: 12px; color: #333;">Diagnoses Used</td>
                        <td style="border: 1px solid #ddd; padding: 12px; color: #333; text-align: right; font-weight: 600;">3 / 3</td>
                    </tr>
                    <tr style="background: #fafafa;">
                        <td style="border: 1px solid #ddd; padding: 12px; color: #333;">Diseases Identified</td>
                        <td style="border: 1px solid #ddd; padding: 12px; color: #333; text-align: right; font-weight: 600;">2</td>
                    </tr>
                    <tr>
                        <td style="border: 1px solid #ddd; padding: 12px; color: #333;">Treatment Plans Accessed</td>
                        <td style="border: 1px solid #ddd; padding: 12px; color: #333; text-align: right; font-weight: 600;">2</td>
                    </tr>
                </table>

                <h3 style="color: #2E7D32; font-size: 16px; margin: 20px 0 15px 0;">Want Unlimited Diagnoses?</h3>
                <p style="color: #333; font-size: 14px; line-height: 1.6; margin: 0 0 20px 0;">With a paid plan, you get unlimited diagnoses, priority support, and advanced analytics. Many farmers find the unlimited access pays for itself with just one prevented crop loss.</p>

                <table width="100%" cellpadding="0" cellspacing="0">
                    <tr>
                        <td align="center" style="padding: 20px 0;">
                            <a href="#" style="background: #2E7D32; color: white; padding: 14px 32px; text-decoration: none; border-radius: 4px; font-weight: 600; display: inline-block; font-size: 15px;">Upgrade to Unlimited</a>
                        </td>
                    </tr>
                </table>

                <p style="color: #666; font-size: 13px; line-height: 1.6; margin: 30px 0 0 0; text-align: center;">For now, make the most of your 3 new diagnoses next month!</p>

                <div style="background: #f5f5f5; padding: 20px; margin: 20px 0 0 0; border-radius: 4px;">
                    <p style="color: #666; font-size: 13px; margin: 0;">¬© 2024 Crop Copilot</p>
                </div>
            </td>
        </tr>
    </table>
</div>
                        `
                    }
                ]
            },
            flow2: {
                title: "Conversion - Upgrade Sequence",
                description: "3-email sequence to convert free users to paid",
                emails: [
                    {
                        id: "limit_hit",
                        number: 1,
                        title: "Limit Hit - Urgency",
                        subject: "You've used all 3 free diagnoses",
                        previewText: "Upgrade now to continue diagnosing",
                        trigger: "3rd diagnosis used",
                        delay: "Immediate",
                        variables: [],
                        htmlBody: `
<div style="background: white; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; max-width: 600px; margin: 0 auto;">
    <table width="100%" cellpadding="0" cellspacing="0" style="background: #2E7D32;">
        <tr>
            <td style="padding: 30px 20px; text-align: center;">
                <h1 style="color: white; margin: 0; font-size: 28px; font-weight: 700;">Crop Copilot</h1>
                <p style="color: rgba(255,255,255,0.8); margin: 5px 0 0 0; font-size: 14px;">Time to Upgrade</p>
            </td>
        </tr>
    </table>

    <table width="100%" cellpadding="0" cellspacing="0" style="background: white;">
        <tr>
            <td style="padding: 40px 30px;">
                <p style="color: #333; font-size: 16px; line-height: 1.6; margin: 0 0 20px 0;">Hi,</p>

                <p style="color: #333; font-size: 16px; line-height: 1.6; margin: 0 0 20px 0;">Great news! You've used all 3 of your free diagnoses this month, which means you're already finding value in Crop Copilot.</p>

                <p style="color: #333; font-size: 16px; line-height: 1.6; margin: 0 0 30px 0;">You have a choice:</p>

                <div style="background: #fef3cd; border-left: 4px solid #2E7D32; padding: 20px; margin: 0 0 30px 0; border-radius: 4px;">
                    <p style="color: #333; font-size: 16px; font-weight: 600; margin: 0 0 10px 0;">‚úì Wait until next month for 3 more free diagnoses</p>
                    <p style="color: #666; font-size: 14px; margin: 0;">or</p>
                    <p style="color: #333; font-size: 16px; font-weight: 600; margin: 10px 0 0 0;">‚Üë Upgrade now and diagnose unlimited crops today</p>
                </div>

                <h3 style="color: #2E7D32; font-size: 18px; margin: 30px 0 15px 0;">The Math: Why Farmers Upgrade</h3>

                <p style="color: #333; font-size: 14px; line-height: 1.6; margin: 0 0 15px 0;">On average, a single crop disease costs farmers <strong>$2,400 in lost yield</strong>. Our platform costs just $99/month.</p>

                <table width="100%" cellpadding="12" cellspacing="0" style="border-collapse: collapse; margin: 0 0 30px 0; background: #f0f8f0;">
                    <tr style="background: #2E7D32;">
                        <th style="border: 1px solid #1B5E20; text-align: left; color: white; font-weight: 600; padding: 12px;">Scenario</th>
                        <th style="border: 1px solid #1B5E20; text-align: right; color: white; font-weight: 600; padding: 12px;">ROI</th>
                    </tr>
                    <tr>
                        <td style="border: 1px solid #ddd; padding: 12px; color: #333;">Prevent 1 disease outbreak</td>
                        <td style="border: 1px solid #ddd; padding: 12px; color: #2E7D32; text-align: right; font-weight: 600;">+$2,301</td>
                    </tr>
                    <tr style="background: #fafafa;">
                        <td style="border: 1px solid #ddd; padding: 12px; color: #333;">Optimize fertilizer usage 1 season</td>
                        <td style="border: 1px solid #ddd; padding: 12px; color: #2E7D32; text-align: right; font-weight: 600;">+$850</td>
                    </tr>
                    <tr>
                        <td style="border: 1px solid #ddd; padding: 12px; color: #333;">Reduce pesticide waste (annual)</td>
                        <td style="border: 1px solid #ddd; padding: 12px; color: #2E7D32; text-align: right; font-weight: 600;">+$1,200</td>
                    </tr>
                </table>

                <p style="color: #333; font-size: 14px; line-height: 1.6; margin: 0 0 25px 0;"><strong>One prevented loss covers a full year of access.</strong></p>

                <table width="100%" cellpadding="0" cellspacing="0">
                    <tr>
                        <td align="center" style="padding: 20px 0;">
                            <a href="#" style="background: #2E7D32; color: white; padding: 14px 32px; text-decoration: none; border-radius: 4px; font-weight: 600; display: inline-block; font-size: 15px;">Unlock Unlimited Diagnoses</a>
                        </td>
                    </tr>
                </table>

                <div style="background: #f5f5f5; padding: 20px; margin: 20px 0 0 0; border-radius: 4px; text-align: center;">
                    <p style="color: #666; font-size: 13px; margin: 0;">¬© 2024 Crop Copilot</p>
                </div>
            </td>
        </tr>
    </table>
</div>
                        `
                    },
                    {
                        id: "case_study",
                        number: 2,
                        title: "Case Study Social Proof",
                        subject: "What one diagnosis saved this Iowa farmer",
                        previewText: "A real story: $12K yield recovery",
                        trigger: "3 days after limit hit",
                        delay: "3 days",
                        variables: [],
                        htmlBody: `
<div style="background: white; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; max-width: 600px; margin: 0 auto;">
    <table width="100%" cellpadding="0" cellspacing="0" style="background: #2E7D32;">
        <tr>
            <td style="padding: 30px 20px; text-align: center;">
                <h1 style="color: white; margin: 0; font-size: 28px; font-weight: 700;">Crop Copilot</h1>
                <p style="color: rgba(255,255,255,0.8); margin: 5px 0 0 0; font-size: 14px;">Real Results from Real Farmers</p>
            </td>
        </tr>
    </table>

    <table width="100%" cellpadding="0" cellspacing="0" style="background: white;">
        <tr>
            <td style="padding: 40px 30px;">
                <p style="color: #333; font-size: 16px; line-height: 1.6; margin: 0 0 20px 0;">Hi,</p>

                <p style="color: #333; font-size: 16px; line-height: 1.6; margin: 0 0 30px 0;">We want to share a story from one of our users that shows the real impact of early diagnosis:</p>

                <div style="background: #f0f8f0; border-left: 4px solid #2E7D32; padding: 25px; margin: 0 0 30px 0; border-radius: 4px;">
                    <p style="color: #1B5E20; font-size: 16px; font-weight: 600; margin: 0 0 15px 0;">"I caught Early Blight before it spread"</p>
                    <p style="color: #333; font-size: 14px; line-height: 1.8; margin: 0;">‚Äî Mark T., Central Iowa</p>
                </div>

                <h3 style="color: #2E7D32; font-size: 16px; margin: 20px 0 15px 0;">The Situation</h3>
                <p style="color: #333; font-size: 14px; line-height: 1.6; margin: 0 0 20px 0;">Mark grows corn and soybeans on 1,200 acres. Mid-August, he noticed unusual spotting on lower corn leaves during his weekly field walk. It could be multiple things‚Äîor nothing serious yet.</p>

                <h3 style="color: #2E7D32; font-size: 16px; margin: 20px 0 15px 0;">The Action</h3>
                <p style="color: #333; font-size: 14px; line-height: 1.6; margin: 0 0 15px 0;">Instead of waiting for it to worsen, Mark took a photo with Crop Copilot. <strong>The AI identified Early Blight with 97% confidence</strong>‚Äîcatching it 2-3 weeks before it typically spreads uncontrollably.</p>

                <p style="color: #333; font-size: 14px; line-height: 1.6; margin: 0 0 20px 0;">He immediately applied the recommended fungicide and adjusted his irrigation schedule. The disease was controlled.</p>

                <h3 style="color: #2E7D32; font-size: 16px; margin: 20px 0 15px 0;">The Results</h3>

                <table width="100%" cellpadding="12" cellspacing="0" style="border-collapse: collapse; margin: 0 0 20px 0; background: #f0f8f0; border: 2px solid #2E7D32;">
                    <tr>
                        <td style="padding: 15px; color: #333; text-align: center; border-bottom: 2px solid #2E7D32;">
                            <p style="color: #2E7D32; font-size: 24px; font-weight: 700; margin: 0;">+$12K</p>
                            <p style="font-size: 13px; margin: 5px 0 0 0;">Yield Recovery</p>
                        </td>
                        <td style="padding: 15px; color: #333; text-align: center;">
                            <p style="color: #2E7D32; font-size: 18px; font-weight: 700; margin: 0;">400 bu</p>
                            <p style="font-size: 13px; margin: 5px 0 0 0;">Corn Saved</p>
                        </td>
                    </tr>
                </table>

                <p style="color: #333; font-size: 14px; line-height: 1.6; margin: 0 0 20px 0;">"If I'd waited another week, Early Blight would've devastated that 200-acre section," Mark said. "Crop Copilot literally paid for itself on that single diagnosis."</p>

                <div style="background: #fef3cd; border-left: 4px solid #ffc107; padding: 15px; margin: 0 0 25px 0; border-radius: 4px;">
                    <p style="color: #856404; font-size: 13px; margin: 0;"><strong>Mark upgraded to unlimited diagnoses the same day.</strong> He now scouts weekly and uses Crop Copilot to confirm what he sees in the field‚Äîtaking the guesswork out entirely.</p>
                </div>

                <p style="color: #333; font-size: 14px; line-height: 1.6; margin: 0 0 25px 0;"><strong>This could be your story.</strong> What is one prevented crop loss worth to your operation?</p>

                <table width="100%" cellpadding="0" cellspacing="0">
                    <tr>
                        <td align="center" style="padding: 20px 0;">
                            <a href="#" style="background: #2E7D32; color: white; padding: 14px 32px; text-decoration: none; border-radius: 4px; font-weight: 600; display: inline-block; font-size: 15px;">Start Unlimited Access</a>
                        </td>
                    </tr>
                </table>

                <div style="background: #f5f5f5; padding: 20px; margin: 20px 0 0 0; border-radius: 4px;">
                    <p style="color: #666; font-size: 13px; margin: 0;">¬© 2024 Crop Copilot | Real results from real farmers</p>
                </div>
            </td>
        </tr>
    </table>
</div>
                        `
                    },
                    {
                        id: "discount_offer",
                        number: 3,
                        title: "Limited-Time Discount",
                        subject: "Last chance: 20% off your first 3 months",
                        previewText: "Expires in 48 hours",
                        trigger: "7 days after limit hit",
                        delay: "7 days",
                        variables: [],
                        htmlBody: `
<div style="background: white; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; max-width: 600px; margin: 0 auto;">
    <table width="100%" cellpadding="0" cellspacing="0" style="background: #2E7D32;">
        <tr>
            <td style="padding: 30px 20px; text-align: center;">
                <h1 style="color: white; margin: 0; font-size: 28px; font-weight: 700;">Crop Copilot</h1>
                <p style="color: rgba(255,255,255,0.8); margin: 5px 0 0 0; font-size: 14px;">‚è∞ Final Offer: 20% Off</p>
            </td>
        </tr>
    </table>

    <table width="100%" cellpadding="0" cellspacing="0" style="background: white;">
        <tr>
            <td style="padding: 40px 30px;">
                <div style="background: #ff6b6b; color: white; padding: 20px; margin: 0 0 25px 0; border-radius: 4px; text-align: center;">
                    <p style="font-size: 14px; margin: 0 0 5px 0; font-weight: 600;">OFFER EXPIRES IN 48 HOURS</p>
                    <p style="font-size: 18px; font-weight: 700; margin: 0;">This is your last reminder</p>
                </div>

                <p style="color: #333; font-size: 16px; line-height: 1.6; margin: 0 0 20px 0;">We haven't heard from you since we hit your free diagnosis limit. Before this offer expires, we wanted to make sure you didn't miss it:</p>

                <div style="background: #f0f8f0; border: 3px solid #2E7D32; padding: 30px; margin: 0 0 30px 0; border-radius: 4px; text-align: center;">
                    <p style="color: #666; font-size: 13px; margin: 0 0 10px 0; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600;">20% OFF</p>
                    <p style="color: #2E7D32; font-size: 36px; font-weight: 700; margin: 0;">$79/month</p>
                    <p style="color: #666; font-size: 13px; margin: 5px 0 0 0;">for your first 3 months</p>
                    <p style="color: #999; font-size: 12px; margin: 8px 0 0 0; text-decoration: line-through;">$99/month regular price</p>
                </div>

                <h3 style="color: #2E7D32; font-size: 16px; margin: 20px 0 15px 0;">What You Get</h3>

                <ul style="color: #333; font-size: 14px; line-height: 1.8; margin: 0 0 30px 0; padding-left: 20px;">
                    <li>‚úì Unlimited crop diagnoses</li>
                    <li>‚úì Lab data import & analysis</li>
                    <li>‚úì Regional alerts & insights</li>
                    <li>‚úì Treatment plans & recommendations</li>
                    <li>‚úì Priority email support</li>
                    <li>‚úì Seasonal planning tools</li>
                </ul>

                <h3 style="color: #2E7D32; font-size: 16px; margin: 20px 0 15px 0;">When This Offer Expires</h3>
                <p style="color: #333; font-size: 14px; line-height: 1.6; margin: 0 0 20px 0;">This special pricing is only available for the next <strong>48 hours</strong>. After that, the regular price of $99/month applies. Upgrade now to lock in the discounted rate for your first 3 months.</p>

                <table width="100%" cellpadding="0" cellspacing="0">
                    <tr>
                        <td align="center" style="padding: 20px 0;">
                            <a href="#" style="background: #2E7D32; color: white; padding: 16px 40px; text-decoration: none; border-radius: 4px; font-weight: 700; display: inline-block; font-size: 15px;">Claim 20% Discount Now</a>
                        </td>
                    </tr>
                </table>

                <p style="color: #666; font-size: 13px; line-height: 1.6; margin: 30px 0 0 0; text-align: center;">No credit card required. Cancel anytime. Most farmers stay for years because they keep seeing ROI.</p>

                <div style="background: #f5f5f5; padding: 20px; margin: 20px 0 0 0; border-radius: 4px;">
                    <p style="color: #666; font-size: 13px; margin: 0;">¬© 2024 Crop Copilot</p>
                </div>
            </td>
        </tr>
    </table>
</div>
                        `
                    }
                ]
            },
            flow3: {
                title: "Seasonal Alert System",
                description: "Triggered email templates for seasonal events",
                emails: [
                    {
                        id: "disease_alert",
                        number: 1,
                        title: "Disease Risk Alert (Template)",
                        subject: "{{disease}} risk is elevated in {{region}} this week",
                        previewText: "Scouting threshold met. Take action now.",
                        trigger: "Manual trigger or automated seasonal",
                        delay: "Varies",
                        variables: ["{{disease}}", "{{region}}", "{{temp}}", "{{humidity}}"],
                        htmlBody: `
<div style="background: white; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; max-width: 600px; margin: 0 auto;">
    <table width="100%" cellpadding="0" cellspacing="0" style="background: #2E7D32;">
        <tr>
            <td style="padding: 30px 20px; text-align: center;">
                <h1 style="color: white; margin: 0; font-size: 28px; font-weight: 700;">Crop Copilot</h1>
                <p style="color: rgba(255,255,255,0.8); margin: 5px 0 0 0; font-size: 14px;">‚ö†Ô∏è Disease Risk Alert</p>
            </td>
        </tr>
    </table>

    <table width="100%" cellpadding="0" cellspacing="0" style="background: white;">
        <tr>
            <td style="padding: 40px 30px;">
                <div style="background: #fff3cd; border: 2px solid #ffc107; padding: 15px; margin: 0 0 25px 0; border-radius: 4px;">
                    <p style="color: #856404; font-size: 14px; font-weight: 600; margin: 0;">‚ö†Ô∏è Risk Level: ELEVATED</p>
                </div>

                <p style="color: #333; font-size: 16px; line-height: 1.6; margin: 0 0 20px 0;">Hi,</p>

                <p style="color: #333; font-size: 16px; line-height: 1.6; margin: 0 0 20px 0;">Conditions in {{region}} are ideal for <strong>{{disease}}</strong> right now. Our risk model shows this is a critical window for scouting and prevention.</p>

                <h3 style="color: #2E7D32; font-size: 16px; margin: 20px 0 15px 0;">Current Conditions in {{region}}</h3>

                <table width="100%" cellpadding="12" cellspacing="0" style="border-collapse: collapse; margin: 0 0 25px 0;">
                    <tr style="background: #f5f5f5;">
                        <th style="border: 1px solid #ddd; text-align: left; color: #2E7D32; font-weight: 600; padding: 12px;">Factor</th>
                        <th style="border: 1px solid #ddd; text-align: right; color: #2E7D32; font-weight: 600; padding: 12px;">Value</th>
                    </tr>
                    <tr>
                        <td style="border: 1px solid #ddd; padding: 12px; color: #333;">Temperature</td>
                        <td style="border: 1px solid #ddd; padding: 12px; color: #333; text-align: right;">{{temp}}¬∞F (optimal range)</td>
                    </tr>
                    <tr style="background: #fafafa;">
                        <td style="border: 1px solid #ddd; padding: 12px; color: #333;">Humidity</td>
                        <td style="border: 1px solid #ddd; padding: 12px; color: #333; text-align: right;">{{humidity}}% (high)</td>
                    </tr>
                    <tr>
                        <td style="border: 1px solid #ddd; padding: 12px; color: #333;">Leaf Wetness</td>
                        <td style="border: 1px solid #ddd; padding: 12px; color: #333; text-align: right;">Extended (risky)</td>
                    </tr>
                </table>

                <h3 style="color: #2E7D32; font-size: 16px; margin: 20px 0 15px 0;">About {{disease}}</h3>

                <p style="color: #333; font-size: 14px; line-height: 1.6; margin: 0 0 15px 0;">{{disease}} spreads rapidly in warm, moist conditions. Early symptoms may appear on lower leaves or in shaded areas of the canopy. Once established, control becomes difficult.</p>

                <h3 style="color: #2E7D32; font-size: 16px; margin: 20px 0 15px 0;">Scouting Checklist</h3>

                <ul style="color: #333; font-size: 14px; line-height: 1.8; margin: 0 0 25px 0; padding-left: 20px;">
                    <li>Scout fields every 5-7 days this week</li>
                    <li>Focus on lower canopy and shaded areas</li>
                    <li>Look for early symptoms (spot patterns, discoloration)</li>
                    <li>Record affected plants and area size</li>
                    <li>Take a photo for confirmation</li>
                </ul>

                <h3 style="color: #2E7D32; font-size: 16px; margin: 20px 0 15px 0;">If You Spot Symptoms</h3>

                <p style="color: #333; font-size: 14px; line-height: 1.6; margin: 0 0 15px 0;">Use Crop Copilot to confirm the disease and get immediate treatment recommendations. Early action prevents widespread infection.</p>

                <table width="100%" cellpadding="0" cellspacing="0">
                    <tr>
                        <td align="center" style="padding: 20px 0;">
                            <a href="#" style="background: #2E7D32; color: white; padding: 14px 32px; text-decoration: none; border-radius: 4px; font-weight: 600; display: inline-block; font-size: 15px;">Scout & Diagnose</a>
                        </td>
                    </tr>
                </table>

                <p style="color: #666; font-size: 13px; line-height: 1.6; margin: 20px 0 0 0;">This alert will be updated as conditions change. Check back tomorrow for updates.</p>

                <div style="background: #f5f5f5; padding: 20px; margin: 20px 0 0 0; border-radius: 4px;">
                    <p style="color: #666; font-size: 13px; margin: 0;">¬© 2024 Crop Copilot | Regional alerts based on local weather data</p>
                </div>
            </td>
        </tr>
    </table>
</div>
                        `
                    },
                    {
                        id: "seasonal_prep",
                        number: 2,
                        title: "Seasonal Prep Checklist (Template)",
                        subject: "{{season}} prep checklist for {{crop}} in {{state}}",
                        previewText: "Get ready for the season ahead",
                        trigger: "Seasonal calendar trigger",
                        delay: "Varies",
                        variables: ["{{season}}", "{{crop}}", "{{state}}"],
                        htmlBody: `
<div style="background: white; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; max-width: 600px; margin: 0 auto;">
    <table width="100%" cellpadding="0" cellspacing="0" style="background: #2E7D32;">
        <tr>
            <td style="padding: 30px 20px; text-align: center;">
                <h1 style="color: white; margin: 0; font-size: 28px; font-weight: 700;">Crop Copilot</h1>
                <p style="color: rgba(255,255,255,0.8); margin: 5px 0 0 0; font-size: 14px;">{{season}} Planning Guide</p>
            </td>
        </tr>
    </table>

    <table width="100%" cellpadding="0" cellspacing="0" style="background: white;">
        <tr>
            <td style="padding: 40px 30px;">
                <p style="color: #333; font-size: 16px; line-height: 1.6; margin: 0 0 20px 0;">Hi,</p>

                <p style="color: #333; font-size: 16px; line-height: 1.6; margin: 0 0 30px 0;">{{season}} is approaching. Use this checklist to prepare your {{crop}} fields for success in {{state}}.</p>

                <h3 style="color: #2E7D32; font-size: 18px; margin: 20px 0 15px 0;">Early {{season}} Checklist</h3>

                <div style="background: #f9f9f9; padding: 20px; margin: 0 0 25px 0; border-radius: 4px;">
                    <table width="100%" cellpadding="12" cellspacing="0">
                        <tr>
                            <td style="padding: 10px 0; color: #333; font-size: 14px;">
                                <input type="checkbox" style="margin-right: 10px;"> Soil test results reviewed
                            </td>
                        </tr>
                        <tr style="background: white;">
                            <td style="padding: 10px 0; color: #333; font-size: 14px;">
                                <input type="checkbox" style="margin-right: 10px;"> Fertility program planned based on {{state}} recommendations
                            </td>
                        </tr>
                        <tr>
                            <td style="padding: 10px 0; color: #333; font-size: 14px;">
                                <input type="checkbox" style="margin-right: 10px;"> Equipment maintenance completed
                            </td>
                        </tr>
                        <tr style="background: white;">
                            <td style="padding: 10px 0; color: #333; font-size: 14px;">
                                <input type="checkbox" style="margin-right: 10px;"> Seed selection finalized
                            </td>
                        </tr>
                    </table>
                </div>

                <h3 style="color: #2E7D32; font-size: 16px; margin: 20px 0 15px 0;">Disease Prevention for {{crop}}</h3>

                <p style="color: #333; font-size: 14px; line-height: 1.6; margin: 0 0 15px 0;">{{season}} brings specific disease pressures in {{state}}. Prepare now:</p>

                <ul style="color: #333; font-size: 14px; line-height: 1.8; margin: 0 0 25px 0; padding-left: 20px;">
                    <li>Scout for overwintering pathogens</li>
                    <li>Plan fungicide rotation (if needed)</li>
                    <li>Set up scouting schedule (weekly recommended)</li>
                    <li>Install monitoring equipment for disease prediction</li>
                </ul>

                <h3 style="color: #2E7D32; font-size: 16px; margin: 20px 0 15px 0;">Recommended Soil Test Metrics</h3>

                <table width="100%" cellpadding="12" cellspacing="0" style="border-collapse: collapse; margin: 0 0 25px 0;">
                    <tr style="background: #f5f5f5;">
                        <th style="border: 1px solid #ddd; text-align: left; color: #2E7D32; font-weight: 600; padding: 12px;">Test Type</th>
                        <th style="border: 1px solid #ddd; text-align: left; color: #2E7D32; font-weight: 600; padding: 12px;">Why It Matters</th>
                    </tr>
                    <tr>
                        <td style="border: 1px solid #ddd; padding: 12px; color: #333;">Macro Nutrients (N-P-K)</td>
                        <td style="border: 1px solid #ddd; padding: 12px; color: #333;">Foundation for growth</td>
                    </tr>
                    <tr style="background: #fafafa;">
                        <td style="border: 1px solid #ddd; padding: 12px; color: #333;">Micronutrients</td>
                        <td style="border: 1px solid #ddd; padding: 12px; color: #333;">Disease resistance & yield</td>
                    </tr>
                    <tr>
                        <td style="border: 1px solid #ddd; padding: 12px; color: #333;">pH & Organic Matter</td>
                        <td style="border: 1px solid #ddd; padding: 12px; color: #333;">Nutrient availability</td>
                    </tr>
                </table>

                <h3 style="color: #2E7D32; font-size: 16px; margin: 20px 0 15px 0;">Crop Copilot's {{season}} Features</h3>

                <ul style="color: #333; font-size: 14px; line-height: 1.8; margin: 0 0 25px 0; padding-left: 20px;">
                    <li>Lab data import for your soil test results</li>
                    <li>Early disease alerts as weather conditions favor outbreak</li>
                    <li>Seasonal scouting reminders</li>
                    <li>Regional {{season}} disease guides</li>
                </ul>

                <table width="100%" cellpadding="0" cellspacing="0">
                    <tr>
                        <td align="center" style="padding: 20px 0;">
                            <a href="#" style="background: #2E7D32; color: white; padding: 14px 32px; text-decoration: none; border-radius: 4px; font-weight: 600; display: inline-block; font-size: 15px;">View {{season}} Guide</a>
                        </td>
                    </tr>
                </table>

                <div style="background: #f0f8f0; border-left: 4px solid #2E7D32; padding: 15px; margin: 25px 0 0 0; border-radius: 4px;">
                    <p style="color: #1B5E20; font-size: 13px; margin: 0;"><strong>Pro tip:</strong> Upload your soil test to Crop Copilot for nutrient deficiency analysis. Lab data + disease scouting = optimized season.</p>
                </div>

                <div style="background: #f5f5f5; padding: 20px; margin: 20px 0 0 0; border-radius: 4px;">
                    <p style="color: #666; font-size: 13px; margin: 0;">¬© 2024 Crop Copilot | {{state}} agricultural expertise</p>
                </div>
            </td>
        </tr>
    </table>
</div>
                        `
                    }
                ]
            },
            flow4: {
                title: "Churn Prevention",
                description: "3-email sequence to prevent cancellation",
                emails: [
                    {
                        id: "reengagement",
                        number: 1,
                        title: "Re-engagement Campaign",
                        subject: "We've improved since you last visited",
                        previewText: "Here's what's new in Crop Copilot",
                        trigger: "No login for 30 days",
                        delay: "30 days",
                        variables: [],
                        htmlBody: `
<div style="background: white; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; max-width: 600px; margin: 0 auto;">
    <table width="100%" cellpadding="0" cellspacing="0" style="background: #2E7D32;">
        <tr>
            <td style="padding: 30px 20px; text-align: center;">
                <h1 style="color: white; margin: 0; font-size: 28px; font-weight: 700;">Crop Copilot</h1>
                <p style="color: rgba(255,255,255,0.8); margin: 5px 0 0 0; font-size: 14px;">What's New</p>
            </td>
        </tr>
    </table>

    <table width="100%" cellpadding="0" cellspacing="0" style="background: white;">
        <tr>
            <td style="padding: 40px 30px;">
                <p style="color: #333; font-size: 16px; line-height: 1.6; margin: 0 0 20px 0;">Hi,</p>

                <p style="color: #333; font-size: 16px; line-height: 1.6; margin: 0 0 20px 0;">We haven't seen you in Crop Copilot for a while. We've been busy improving the platform, and there are some features we think you'll love.</p>

                <h3 style="color: #2E7D32; font-size: 18px; margin: 30px 0 15px 0;">New Features Since You Left</h3>

                <div style="background: #f9f9f9; border-left: 4px solid #2E7D32; padding: 20px; margin: 0 0 20px 0;">
                    <h4 style="color: #2E7D32; margin: 0 0 10px 0; font-size: 15px;">‚ú® Mobile App (New!)</h4>
                    <p style="color: #666; font-size: 14px; margin: 0;">Diagnose right from your field. Same AI analysis, pocket-sized.</p>
                </div>

                <div style="background: #f9f9f9; border-left: 4px solid #2E7D32; padding: 20px; margin: 0 0 20px 0;">
                    <h4 style="color: #2E7D32; margin: 0 0 10px 0; font-size: 15px;">üìä Advanced Analytics</h4>
                    <p style="color: #666; font-size: 14px; margin: 0;">See disease patterns across your fields over time. Predictive insights for next season.</p>
                </div>

                <div style="background: #f9f9f9; border-left: 4px solid #2E7D32; padding: 20px; margin: 0 0 20px 0;">
                    <h4 style="color: #2E7D32; margin: 0 0 10px 0; font-size: 15px;">ü§ù Team Management</h4>
                    <p style="color: #666; font-size: 14px; margin: 0;">Add scouts or agronomists to your account. Centralized reporting.</p>
                </div>

                <div style="background: #f9f9f9; border-left: 4px solid #2E7D32; padding: 20px; margin: 0 0 25px 0;">
                    <h4 style="color: #2E7D32; margin: 0 0 10px 0; font-size: 15px;">üåæ Regional Alerts</h4>
                    <p style="color: #666; font-size: 14px; margin: 0;">Automatic notifications when disease risk spikes in your area. Never miss a critical window.</p>
                </div>

                <h3 style="color: #2E7D32; font-size: 16px; margin: 20px 0 15px 0;">Why Come Back?</h3>

                <ul style="color: #333; font-size: 14px; line-height: 1.8; margin: 0 0 25px 0; padding-left: 20px;">
                    <li><strong>Faster Diagnoses</strong> - AI model improved 23% accuracy since launch</li>
                    <li><strong>More Integrations</strong> - Connect with your farm management software</li>
                    <li><strong>Better Mobile</strong> - Scout from the field in real-time</li>
                    <li><strong>Smarter Alerts</strong> - Only get notifications that matter to you</li>
                </ul>

                <table width="100%" cellpadding="0" cellspacing="0">
                    <tr>
                        <td align="center" style="padding: 20px 0;">
                            <a href="#" style="background: #2E7D32; color: white; padding: 14px 32px; text-decoration: none; border-radius: 4px; font-weight: 600; display: inline-block; font-size: 15px;">Log Back In & Explore</a>
                        </td>
                    </tr>
                </table>

                <p style="color: #666; font-size: 13px; line-height: 1.6; margin: 30px 0 0 0; text-align: center;">Your account is still active. Your diagnoses are waiting.</p>

                <div style="background: #f5f5f5; padding: 20px; margin: 20px 0 0 0; border-radius: 4px;">
                    <p style="color: #666; font-size: 13px; margin: 0;">¬© 2024 Crop Copilot</p>
                </div>
            </td>
        </tr>
    </table>
</div>
                        `
                    },
                    {
                        id: "offseason_value",
                        number: 2,
                        title: "Off-Season Value Proposition",
                        subject: "Plan next season's fertility program now",
                        previewText: "Get ahead with planning tools",
                        trigger: "November user entry",
                        delay: "~September",
                        variables: [],
                        htmlBody: `
<div style="background: white; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; max-width: 600px; margin: 0 auto;">
    <table width="100%" cellpadding="0" cellspacing="0" style="background: #2E7D32;">
        <tr>
            <td style="padding: 30px 20px; text-align: center;">
                <h1 style="color: white; margin: 0; font-size: 28px; font-weight: 700;">Crop Copilot</h1>
                <p style="color: rgba(255,255,255,0.8); margin: 5px 0 0 0; font-size: 14px;">Off-Season Planning</p>
            </td>
        </tr>
    </table>

    <table width="100%" cellpadding="0" cellspacing="0" style="background: white;">
        <tr>
            <td style="padding: 40px 30px;">
                <p style="color: #333; font-size: 16px; line-height: 1.6; margin: 0 0 20px 0;">Hi,</p>

                <p style="color: #333; font-size: 16px; line-height: 1.6; margin: 0 0 20px 0;">While the season winds down, now is the perfect time to plan for next year. We want to help you make your 2025 season even better than 2024.</p>

                <h3 style="color: #2E7D32; font-size: 18px; margin: 30px 0 15px 0;">Off-Season Planning Checklist</h3>

                <div style="background: #f9f9f9; padding: 20px; margin: 0 0 25px 0; border-radius: 4px;">
                    <h4 style="color: #2E7D32; margin: 0 0 15px 0; font-size: 15px;">October-November</h4>
                    <ul style="color: #333; font-size: 13px; line-height: 1.8; margin: 0; padding-left: 20px;">
                        <li>‚úì Schedule soil test (best time: fall)</li>
                        <li>‚úì Review this season's disease patterns with Crop Copilot data</li>
                        <li>‚úì Plan crop rotation strategy</li>
                        <li>‚úì Set fertility targets for next season</li>
                    </ul>
                </div>

                <div style="background: #f9f9f9; padding: 20px; margin: 0 0 25px 0; border-radius: 4px;">
                    <h4 style="color: #2E7D32; margin: 0 0 15px 0; font-size: 15px;">December-February</h4>
                    <ul style="color: #333; font-size: 13px; line-height: 1.8; margin: 0; padding-left: 20px;">
                        <li>‚úì Input soil test results into Crop Copilot</li>
                        <li>‚úì Build custom fertility programs</li>
                        <li>‚úì Plan preventive fungicide strategy</li>
                        <li>‚úì Seed selection & ordering</li>
                    </ul>
                </div>

                <h3 style="color: #2E7D32; font-size: 16px; margin: 20px 0 15px 0;">This Year's Data Tells a Story</h3>

                <p style="color: #333; font-size: 14px; line-height: 1.6; margin: 0 0 15px 0;">Your Crop Copilot history from 2024 shows which diseases hit your fields hardest. We can use this data to prevent them from becoming problems next year:</p>

                <table width="100%" cellpadding="12" cellspacing="0" style="border-collapse: collapse; margin: 0 0 25px 0;">
                    <tr style="background: #f5f5f5;">
                        <th style="border: 1px solid #ddd; text-align: left; color: #2E7D32; font-weight: 600; padding: 12px;">Disease</th>
                        <th style="border: 1px solid #ddd; text-align: right; color: #2E7D32; font-weight: 600; padding: 12px;">Detections</th>
                        <th style="border: 1px solid #ddd; text-align: left; color: #2E7D32; font-weight: 600; padding: 12px;">Prevention Strategy</th>
                    </tr>
                    <tr>
                        <td style="border: 1px solid #ddd; padding: 12px; color: #333;">Early Blight</td>
                        <td style="border: 1px solid #ddd; padding: 12px; color: #333; text-align: right;">3</td>
                        <td style="border: 1px solid #ddd; padding: 12px; color: #333;">Resistant varieties + early scouting</td>
                    </tr>
                    <tr style="background: #fafafa;">
                        <td style="border: 1px solid #ddd; padding: 12px; color: #333;">Nitrogen Deficiency</td>
                        <td style="border: 1px solid #ddd; padding: 12px; color: #333; text-align: right;">5</td>
                        <td style="border: 1px solid #ddd; padding: 12px; color: #333;">Adjusted fertility plan + tissue testing</td>
                    </tr>
                </table>

                <h3 style="color: #2E7D32; font-size: 16px; margin: 20px 0 15px 0;">Soil Testing: The Foundation</h3>

                <p style="color: #333; font-size: 14px; line-height: 1.6; margin: 0 0 15px 0;">Fall is the ideal time to collect soil samples while fields are still accessible. Once you have results, upload them to Crop Copilot to:</p>

                <ul style="color: #333; font-size: 14px; line-height: 1.8; margin: 0 0 25px 0; padding-left: 20px;">
                    <li>Identify nutrient imbalances before they affect yield</li>
                    <li>Calculate exact fertilizer rates (no guessing)</li>
                    <li>Prevent deficiencies next year</li>
                    <li>Optimize ROI on fertilizer spending</li>
                </ul>

                <table width="100%" cellpadding="0" cellspacing="0">
                    <tr>
                        <td align="center" style="padding: 20px 0;">
                            <a href="#" style="background: #2E7D32; color: white; padding: 14px 32px; text-decoration: none; border-radius: 4px; font-weight: 600; display: inline-block; font-size: 15px;">Start Planning for 2025</a>
                        </td>
                    </tr>
                </table>

                <div style="background: #f0f8f0; border-left: 4px solid #2E7D32; padding: 15px; margin: 25px 0 0 0; border-radius: 4px;">
                    <p style="color: #1B5E20; font-size: 13px; margin: 0;"><strong>Pro tip:</strong> Farmers who plan in the off-season typically have higher yields and lower input costs. The work you do now saves you money and headaches next season.</p>
                </div>

                <div style="background: #f5f5f5; padding: 20px; margin: 20px 0 0 0; border-radius: 4px;">
                    <p style="color: #666; font-size: 13px; margin: 0;">¬© 2024 Crop Copilot</p>
                </div>
            </td>
        </tr>
    </table>
</div>
                        `
                    },
                    {
                        id: "renewal_offer",
                        number: 3,
                        title: "Renewal Discount Offer",
                        subject: "Renew early and save 25%",
                        previewText: "Special pricing if you renew before {{expiry_date}}",
                        trigger: "30 days before annual expiry",
                        delay: "~335 days",
                        variables: ["{{expiry_date}}"],
                        htmlBody: `
<div style="background: white; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; max-width: 600px; margin: 0 auto;">
    <table width="100%" cellpadding="0" cellspacing="0" style="background: #2E7D32;">
        <tr>
            <td style="padding: 30px 20px; text-align: center;">
                <h1 style="color: white; margin: 0; font-size: 28px; font-weight: 700;">Crop Copilot</h1>
                <p style="color: rgba(255,255,255,0.8); margin: 5px 0 0 0; font-size: 14px;">Renewal Special Offer</p>
            </td>
        </tr>
    </table>

    <table width="100%" cellpadding="0" cellspacing="0" style="background: white;">
        <tr>
            <td style="padding: 40px 30px;">
                <div style="background: #f0f8f0; border: 2px solid #2E7D32; padding: 20px; margin: 0 0 25px 0; border-radius: 4px; text-align: center;">
                    <p style="color: #2E7D32; font-size: 18px; font-weight: 700; margin: 0 0 8px 0;">25% Off Renewal</p>
                    <p style="color: #666; font-size: 13px; margin: 0;">Valid if you renew by {{expiry_date}}</p>
                </div>

                <p style="color: #333; font-size: 16px; line-height: 1.6; margin: 0 0 20px 0;">Hi,</p>

                <p style="color: #333; font-size: 16px; line-height: 1.6; margin: 0 0 20px 0;">Your Crop Copilot subscription is set to expire on <strong>{{expiry_date}}</strong>. We'd love to have you continue using our platform next year, and we're offering special renewal pricing.</p>

                <h3 style="color: #2E7D32; font-size: 18px; margin: 30px 0 15px 0;">Your 2024 Impact</h3>

                <table width="100%" cellpadding="12" cellspacing="0" style="border-collapse: collapse; margin: 0 0 25px 0; background: #f0f8f0; border: 1px solid #2E7D32;">
                    <tr>
                        <td style="padding: 15px; color: #333; text-align: center; border-right: 1px solid #2E7D32;">
                            <p style="color: #2E7D32; font-size: 24px; font-weight: 700; margin: 0;">24</p>
                            <p style="font-size: 13px; margin: 5px 0 0 0;">Diagnoses Made</p>
                        </td>
                        <td style="padding: 15px; color: #333; text-align: center; border-right: 1px solid #2E7D32;">
                            <p style="color: #2E7D32; font-size: 24px; font-weight: 700; margin: 0;">8</p>
                            <p style="font-size: 13px; margin: 5px 0 0 0;">Diseases Identified</p>
                        </td>
                        <td style="padding: 15px; color: #333; text-align: center;">
                            <p style="color: #2E7D32; font-size: 24px; font-weight: 700; margin: 0;">$18K+</p>
                            <p style="font-size: 13px; margin: 5px 0 0 0;">Est. Value Saved</p>
                        </td>
                    </tr>
                </table>

                <h3 style="color: #2E7D32; font-size: 16px; margin: 20px 0 15px 0;">Renewal Pricing - Limited Time</h3>

                <div style="background: #fff9e6; border: 2px solid #ffc107; padding: 20px; margin: 0 0 25px 0; border-radius: 4px;">
                    <p style="color: #333; font-size: 13px; margin: 0 0 10px 0;"><strong>Early Renewal (by {{expiry_date}}):</strong></p>
                    <p style="color: #2E7D32; font-size: 28px; font-weight: 700; margin: 0;">$74.25/month</p>
                    <p style="color: #666; font-size: 12px; margin: 8px 0 0 0;"><del>$99/month</del> ‚Äî Save $297 annually</p>
                </div>

                <p style="color: #333; font-size: 14px; line-height: 1.6; margin: 0 0 20px 0;">This pricing is locked in for the first year of your renewal. After {{expiry_date}}, renewal pricing returns to $99/month.</p>

                <h3 style="color: #2E7D32; font-size: 16px; margin: 20px 0 15px 0;">What's Included in Your Renewal</h3>

                <ul style="color: #333; font-size: 14px; line-height: 1.8; margin: 0 0 25px 0; padding-left: 20px;">
                    <li>‚úì Unlimited crop diagnoses</li>
                    <li>‚úì Lab data analytics</li>
                    <li>‚úì Regional disease alerts</li>
                    <li>‚úì All new features added in 2025</li>
                    <li>‚úì Priority email & chat support</li>
                    <li>‚úì Team management tools</li>
                </ul>

                <table width="100%" cellpadding="0" cellspacing="0">
                    <tr>
                        <td align="center" style="padding: 20px 0;">
                            <a href="#" style="background: #2E7D32; color: white; padding: 14px 32px; text-decoration: none; border-radius: 4px; font-weight: 600; display: inline-block; font-size: 15px;">Renew at 25% Off</a>
                        </td>
                    </tr>
                </table>

                <h3 style="color: #2E7D32; font-size: 16px; margin: 30px 0 15px 0;">Questions?</h3>

                <p style="color: #666; font-size: 14px; line-height: 1.6; margin: 0;">If you'd like to discuss your subscription or have questions, reach out to our support team. We're here to help.</p>

                <div style="background: #f5f5f5; padding: 20px; margin: 20px 0 0 0; border-radius: 4px;">
                    <p style="color: #666; font-size: 13px; margin: 0;">¬© 2024 Crop Copilot | Thank you for being part of our farming community</p>
                </div>
            </td>
        </tr>
    </table>
</div>
                        `
                    }
                ]
            }
        };

        // ============================================
        // APPLICATION STATE & RENDERING
        // ============================================

        const app = {
            currentExportFormat: null,
            currentFlow: 'flow1',

            init() {
                this.renderEmails();
                this.setupTabListeners();
            },

            renderEmails() {
                Object.entries(emailFlows).forEach(([flowKey, flowData]) => {
                    const container = document.getElementById(`${flowKey}-emails`);
                    container.innerHTML = '';
                    
                    flowData.emails.forEach(email => {
                        container.appendChild(this.createEmailCard(email));
                    });
                });
            },

            createEmailCard(email) {
                const card = document.createElement('div');
                card.className = 'email-card';

                const variablesText = email.variables.length > 0 
                    ? email.variables.join(', ') 
                    : 'None';

                card.innerHTML = `
                    <div class="email-header">
                        <h3>Email ${email.number}: ${email.title}</h3>
                        <div class="email-meta">
                            <div class="email-meta-item">
                                <span class="email-meta-label">Trigger</span>
                                <span class="email-meta-value">${email.trigger}</span>
                            </div>
                            <div class="email-meta-item">
                                <span class="email-meta-label">Delay</span>
                                <span class="email-meta-value">${email.delay}</span>
                            </div>
                        </div>
                    </div>

                    <div class="email-specs">
                        <div class="spec-row">
                            <span class="spec-label">Subject Line</span>
                            <div class="spec-value">${email.subject}</div>
                        </div>
                        <div class="spec-row">
                            <span class="spec-label">Preview Text</span>
                            <div class="spec-value">${email.previewText}</div>
                        </div>
                        <div class="spec-row">
                            <span class="spec-label">Personalization Variables</span>
                            <div class="spec-value">${variablesText}</div>
                        </div>
                    </div>

                    <div class="email-preview">
                        <label class="email-preview-label">Email Body Preview</label>
                        <div class="email-body">${email.htmlBody}</div>
                        <div class="button-group">
                            <button class="btn btn-copy" onclick="app.copyEmailHTML('${email.id}')">Copy HTML</button>
                            <button class="btn btn-preview" onclick="app.downloadEmailHTML('${email.id}')">Download</button>
                        </div>
                    </div>
                `;

                return card;
            },

            setupTabListeners() {
                const tabButtons = document.querySelectorAll('.tab-button');
                tabButtons.forEach(button => {
                    button.addEventListener('click', (e) => {
                        tabButtons.forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');

                        document.querySelectorAll('.tab-content').forEach(content => {
                            content.classList.remove('active');
                        });

                        const tabId = e.target.dataset.tab;
                        this.currentFlow = tabId;
                        document.getElementById(tabId).classList.add('active');
                    });
                });
            },

            copyEmailHTML(emailId) {
                const email = this.findEmailById(emailId);
                if (!email) return;

                navigator.clipboard.writeText(email.htmlBody).then(() => {
                    this.showToast('HTML copied to clipboard!');
                });
            },

            downloadEmailHTML(emailId) {
                const email = this.findEmailById(emailId);
                if (!email) return;

                const element = document.createElement('a');
                element.setAttribute('href', 'data:text/html;charset=utf-8,' + encodeURIComponent(email.htmlBody));
                element.setAttribute('download', `${emailId}-email.html`);
                element.style.display = 'none';
                document.body.appendChild(element);
                element.click();
                document.body.removeChild(element);
            },

            findEmailById(emailId) {
                for (const flow of Object.values(emailFlows)) {
                    const email = flow.emails.find(e => e.id === emailId);
                    if (email) return email;
                }
                return null;
            },

            toggleExportFormat(format) {
                this.currentExportFormat = format;
                const container = document.getElementById('exportPreviewContainer');
                const preview = document.getElementById('exportPreview');
                
                let content = '';
                if (format === 'json') {
                    content = this.generateJSONExport();
                } else if (format === 'csv') {
                    content = this.generateCSVExport();
                } else if (format === 'markdown') {
                    content = this.generateMarkdownExport();
                }

                preview.textContent = content;
                container.style.display = 'block';
            },

            generateJSONExport() {
                const data = {
                    platform: 'Crop Copilot',
                    version: '1.0',
                    exported: new Date().toISOString(),
                    flows: []
                };

                Object.entries(emailFlows).forEach(([flowKey, flowData]) => {
                    const flow = {
                        id: flowKey,
                        name: flowData.title,
                        emails: flowData.emails.map(email => ({
                            id: email.id,
                            number: email.number,
                            title: email.title,
                            subject: email.subject,
                            previewText: email.previewText,
                            trigger: email.trigger,
                            delay: email.delay,
                            variables: email.variables
                        }))
                    };
                    data.flows.push(flow);
                });

                return JSON.stringify(data, null, 2);
            },

            generateCSVExport() {
                let csv = 'Flow,Email Number,Title,Subject,Preview Text,Trigger,Delay,Variables\n';

                Object.entries(emailFlows).forEach(([flowKey, flowData]) => {
                    flowData.emails.forEach(email => {
                        const variables = email.variables.join('; ');
                        const row = [
                            flowData.title,
                            email.number,
                            email.title,
                            `"${email.subject}"`,
                            `"${email.previewText}"`,
                            email.trigger,
                            email.delay,
                            variables
                        ].join(',');
                        csv += row + '\n';
                    });
                });

                return csv;
            },

            generateMarkdownExport() {
                let md = '# Crop Copilot Email Automation System\n\n';
                md += `Exported: ${new Date().toLocaleString()}\n\n`;
                md += '## Flows\n\n';

                Object.entries(emailFlows).forEach(([flowKey, flowData]) => {
                    md += `### ${flowData.title}\n\n`;
                    md += `${flowData.description}\n\n`;

                    flowData.emails.forEach(email => {
                        md += `#### Email ${email.number}: ${email.title}\n\n`;
                        md += `- **Subject:** ${email.subject}\n`;
                        md += `- **Preview:** ${email.previewText}\n`;
                        md += `- **Trigger:** ${email.trigger}\n`;
                        md += `- **Delay:** ${email.delay}\n`;
                        if (email.variables.length > 0) {
                            md += `- **Variables:** ${email.variables.join(', ')}\n`;
                        }
                        md += '\n';
                    });

                    md += '\n';
                });

                return md;
            },

            downloadExport() {
                const format = this.currentExportFormat;
                const preview = document.getElementById('exportPreview');
                const content = preview.textContent;

                let filename = 'crop-copilot-emails';
                let mimeType = 'text/plain';

                if (format === 'json') {
                    filename += '.json';
                    mimeType = 'application/json';
                } else if (format === 'csv') {
                    filename += '.csv';
                    mimeType = 'text/csv';
                } else if (format === 'markdown') {
                    filename += '.md';
                    mimeType = 'text/markdown';
                }

                const element = document.createElement('a');
                element.setAttribute('href', 'data:' + mimeType + ';charset=utf-8,' + encodeURIComponent(content));
                element.setAttribute('download', filename);
                element.style.display = 'none';
                document.body.appendChild(element);
                element.click();
                document.body.removeChild(element);
            },

            copyExport() {
                const preview = document.getElementById('exportPreview');
                navigator.clipboard.writeText(preview.textContent).then(() => {
                    this.showToast('Export copied to clipboard!');
                });
            },

            showToast(message) {
                const toast = document.createElement('div');
                toast.className = 'toast';
                toast.textContent = message;
                document.body.appendChild(toast);

                setTimeout(() => {
                    toast.remove();
                }, 3000);
            }
        };

        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            app.init();
        });
    </script>
</body>
</html>
